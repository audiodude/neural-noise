<!DOCTYPE html>
<html>
<head>
	<script src="/static/js/inc/shim/Base64.js" type="text/javascript"></script>
	<script src="/static/js/inc/shim/Base64binary.js" type="text/javascript"></script>
	<script src="/static/js/inc/shim/WebAudioAPI.js" type="text/javascript"></script>
	<script src="/static/js/inc/shim/WebMIDIAPI.js" type="text/javascript"></script>
	<script src="/static/js/inc/jasmid/stream.js"></script>
	<script src="/static/js/inc/jasmid/midifile.js"></script>
	<script src="/static/js/inc/jasmid/replayer.js"></script>
	<script src="/static/js/midi/audioDetect.js" type="text/javascript"></script>
	<script src="/static/js/midi/gm.js" type="text/javascript"></script>
	<script src="/static/js/midi/loader.js" type="text/javascript"></script>
	<script src="/static/js/midi/plugin.audiotag.js" type="text/javascript"></script>
	<script src="/static/js/midi/plugin.webaudio.js" type="text/javascript"></script>
	<script src="/static/js/midi/plugin.webmidi.js" type="text/javascript"></script>
	<script src="/static/js/midi/player.js" type="text/javascript"></script>
	<script src="/static/js/util/dom_request_xhr.js" type="text/javascript"></script>
	<script src="/static/js/util/dom_request_script.js" type="text/javascript"></script>
	<script src="/static/js/inc/timer.js" type="text/javascript"></script>
	<script src="/static/js/inc/colorspace.js" type="text/javascript"></script>
	<script src="/static/js/inc/event.js" type="text/javascript"></script>

  <script>
    var song = 'data:audio/midi;base64,{{ song['midi'] }}';
    var player;
    window.onload = function() {
      MIDI.loadPlugin({
        soundfontUrl: '/static/soundfont/',
        instruments: [
          'acoustic_grand_piano',
          'bright_acoustic_piano'
        ],
        onsuccess: function() {
          /// this sets up the MIDI.Player and gets things going...
          player = MIDI.Player;
          player.timeWarp = 1; // speed the song is played back
          player.loadFile(song, function() {
            document.getElementById('playpause').disabled = false;
          });
        }
      });
    }

    var is_playing = false;
    function playpause() {
      if (is_playing) {
        player.pause();
        document.getElementById('playpause').innerHTML = 'Resume';
        is_playing = false;
      } else {
        player.start();
        document.getElementById('playpause').innerHTML = 'Pause';
        is_playing = true;
      }
    }
  </script>
</head>
<body>
  <p>Welcome to the song explorer.</p>
  <p><textarea rows="30" cols="90">{{ song['abc'] }}</textarea></p>
  <p><button id="playpause" onclick="playpause()" disabled="disabled">Play</button></p>
  <p><img src="/png/{{ song['_id'] }}.png"/></p>
</body>
</html>
